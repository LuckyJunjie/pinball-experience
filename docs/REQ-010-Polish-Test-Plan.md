# REQ-010 Polish - 测试计划

## 概述

**REQ-010 Polish** 是 pinball-experience 项目的优化完善阶段，包括物理调优、动画反馈和音效系统。

根据 BASELINE-STEPS.md §0.10 和开发计划，Polish 包含三个主要方面：

1. **物理调优** - 挡板弹力、弹跳、摩擦力
2. **动画反馈** - 得分弹窗、倍率脉冲、UI 过渡
3. **音效系统** - 挡板、排水、发射、技能射击、多球、连击

---

## 测试范围

### 需要测试的内容

#### 1. 物理调优 (Physics)
| 组件 | 测试项 | 验收标准 |
|------|--------|----------|
| Flipper | 弹力强度 | 挡板能正确击打球，响应时间 < 16ms |
| Ball | 弹跳系数 | ball restitution = 0.8 |
| Ball | 摩擦力 | ball friction = 0.3 |
| Wall | 边界弹跳 | wall restitution = 0.7 |
| Bumper | 弹力系数 | bumper restitution = 0.95 |

#### 2. 动画反馈 (Animation)
| 组件 | 测试项 | 验收标准 |
|------|--------|----------|
| ScorePopup | 得分弹窗显示 | 击中障碍物后显示得分弹窗 |
| ScorePopup | 弹窗消失 | 1-2秒后自动消失 |
| Multiplier | 倍率变化动画 | 倍率变化时有视觉反馈 |
| UI | 过渡动画 | 状态切换有平滑过渡 |

#### 3. 音效系统 (Sound)
| 事件 | 测试项 | 验收标准 |
|------|--------|----------|
| ball_launch | 发射音效 | 按下发射键时播放 |
| ball_lost | 球掉落音效 | 球进入 Drain 时播放 |
| flipper_click | 挡板音效 | 按下挡板时播放 |
| obstacle_hit | 障碍物音效 | 击中障碍物时播放 |
| hold_entry | 加分区音效 | 进入加分区时播放 |
| skill_shot | 技能射击音效 | 击中技能射击目标时播放 |
| multiball | 多球音效 | 生成 bonus ball 时播放 |
| combo | 连击音效 | 连击增加时播放 |

---

## 测试矩阵

### 单元测试 (Unit Tests)

#### 物理类
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| UT-010-01 | Flipper弹力 | 检查 Flipper 节点的 torque/force 参数 | 符合设计值 |
| UT-010-02 | Ball物理材质 | 检查 Ball 节点的 physics_material | restitution=0.8, friction=0.3 |
| UT-010-03 | Bumper物理 | 检查 Bumper 节点的 restitution | 0.95 |
| UT-010-04 | Wall边界 | 检查 Wall 节点的 restitution | 0.7 |

#### 音效类
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| UT-010-05 | SoundManager加载 | 检查 SOUND_PATHS 常量 | 包含所有音效 |
| UT-010-06 | 音效文件存在 | 检查各音效文件是否存在 | 所有文件可加载 |
| UT-010-07 | play_sound方法 | 检查 play_sound 方法存在 | 方法存在 |
| UT-010-08 | 音效播放 | 调用 play_sound("ball_launch") | 无错误 |

#### 动画类
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| UT-010-09 | ScorePopup节点 | 检查 ScorePopup 场景/脚本存在 | 存在 |
| UT-010-10 | 动画配置 | 检查动画时长/曲线 | 符合设计 |

---

### 集成测试 (Integration Tests)

#### 音效集成
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| IT-010-01 | 发射音效集成 | 发射球时触发 ball_launch | 播放音效 |
| IT-010-02 | 障碍物音效 | 击中障碍物触发 obstacle_hit | 播放音效 |
| IT-010-03 | Drain音效 | 球掉入 Drain 触发 ball_lost | 播放音效 |
| IT-010-04 | 挡板音效 | 按下挡板触发 flipper_click | 播放音效 |
| IT-010-05 | 连击音效 | 连击增加时播放 combo 音效 | 播放音效 |
| IT-010-06 | 多球音效 | bonus ball 生成时播放 | 播放音效 |

#### 动画集成
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| IT-010-07 | 得分弹窗 | 得分时显示得分弹窗 | 弹窗显示 |
| IT-010-08 | 弹窗动画 | 得分弹窗有淡出动画 | 动画正常 |
| IT-010-09 | 倍率变化动画 | 倍率变化时触发视觉反馈 | 有反馈 |

#### 物理集成
| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| IT-010-10 | 挡板击打 | 球能被挡板击打返回 | 球运动方向改变 |
| IT-010-11 | 球弹跳 | 球在障碍物上弹跳 | 符合 restitution |

---

### E2E 测试 (End-to-End Tests)

| ID | 测试名称 | 测试内容 | 预期结果 |
|----|----------|----------|----------|
| E2E-010-01 | 完整游戏音效 | 完整游戏流程 | 所有音效正常播放 |
| E2E-010-02 | 完整动画流程 | 完整游戏流程 | 动画反馈正常 |

---

## 验收标准覆盖

| 功能 | 验收标准 | 测试覆盖 |
|------|----------|----------|
| 物理调优 | flipper 响应 < 16ms | UT-010-01, IT-010-10 |
| 物理调优 | ball restitution = 0.8 | UT-010-02, IT-010-11 |
| 物理调优 | bumper restitution = 0.95 | UT-010-03 |
| 物理调优 | wall restitution = 0.7 | UT-010-04 |
| 动画 | 得分弹窗显示 | IT-010-07, IT-010-08 |
| 动画 | 倍率变化反馈 | IT-010-09 |
| 音效 | 发射音效 | IT-010-01 |
| 音效 | 障碍物音效 | IT-010-02 |
| 音效 | Drain 音效 | IT-010-03 |
| 音效 | 挡板音效 | IT-010-04 |
| 音效 | 连击音效 | IT-010-05 |
| 音效 | 多球音效 | IT-010-06 |

---

## 测试文件结构

```
test/
├── unit/
│   └── test_polish.gd          # 单元测试
├── integration/
│   └── test_polish.gd          # 集成测试
└── TEST_COVERAGE_010.md        # 本文档
```

---

## 运行测试

```bash
# 单元测试
godot --headless --script test/unit/test_polish.gd

# 集成测试
godot --headless --script test/integration/test_polish.gd

# 运行所有 REQ-010 测试
godot --headless --script test/run_tests.gd
```

---

## 依赖

- **REQ-004** (障碍物 + 计分) - 计分触发得分弹窗
- **REQ-006** (Skill shot) - 技能射击音效
- **REQ-007** (Multiplier) - 倍率变化动画
- **REQ-008** (Multiball) - 多球音效
- **REQ-009** (Combo) - 连击音效

---

## 备注

1. 物理测试需要实际运行游戏或使用 Godot 物理测试框架
2. 音效测试需要音频设备或使用 mock 模式
3. 部分动画测试可能需要截图对比测试

---

*文档创建时间: 2026-03-01*
